<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026è·¨å¹´çƒŸèŠ±ç¥ç¦</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            height: 100vh;
            overflow: hidden;
            position: relative;
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
        }

        /* èƒŒæ™¯æ˜Ÿç©ºæ•ˆæœ */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            animation: twinkle ease-in-out infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* å€’è®¡æ—¶ç»„ä»¶ */
        .countdown {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 999;
            color: #fff;
            font-size: 24px;
            text-shadow: 0 0 10px #ffd700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .countdown-number {
            background: rgba(255, 215, 0, 0.2);
            padding: 5px 15px;
            border-radius: 8px;
            border: 1px solid #ffd700;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .photo-wrap {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
            opacity: 1;
            pointer-events: none;
            transition: all 0.8s ease;
        }
        .photo-wrap.zoom-in {
            transform: translate(-50%, -50%) scale(1.05);
        }
        .photo-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
            perspective: 1000px;
        }
        .photo {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            border: 6px solid #ffd700;
            box-shadow: 0 0 30px #ffd700;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: #ffd700;
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: center;
        }
        /* å¼ºåˆ¶æ˜¾ç¤ºé»˜è®¤ç…§ç‰‡ï¼Œè§£å†³åˆå§‹æ— ç…§ç‰‡é—®é¢˜ */
        .photo.photo1 {
            opacity: 1;
            transform: rotateY(0deg) scale(1);
        }
        .photo.active {
            opacity: 1 !important;
            transform: rotateY(0deg) scale(1) !important;
        }
        .photo.next {
            opacity: 0;
            transform: rotateY(90deg) scale(0.9);
        }
        .photo.prev {
            opacity: 0;
            transform: rotateY(-90deg) scale(0.9);
        }

        .title {
            font-size: clamp(24px, 5vw, 36px);
            color: #fff;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ffd700;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px #ffd700; }
            to { text-shadow: 0 0 20px #ffd700, 0 0 30px #ff9900; }
        }

        .bless {
            font-size: clamp(16px, 3vw, 20px);
            color: #fff;
            line-height: 1.8;
            margin-top: 15px;
            text-shadow: 0 0 5px #000;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.5);
        }

        /* çƒŸèŠ±å®¹å™¨ */
        .firework-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        .fire-trail {
            position: absolute;
            width: 4px;
            height: 25px;
            border-radius: 50% 50% 0 0;
            background: linear-gradient(to top, #ff6600, #ffff00, #ffffff);
            box-shadow: 0 0 8px #ffff00, 0 0 15px #ff6600;
            bottom: 0; 
            animation: fly-up 1.5s ease-out forwards, sway 0.3s ease-in-out infinite;
        }
        @keyframes fly-up {
            0% { transform: translateY(0); opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(calc(-1 * var(--top))); opacity: 0; }
        }
        @keyframes sway {
            0% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(3px) translateY(0); }
            100% { transform: translateX(-3px) translateY(0); }
        }

        .fire-burst {
            position: absolute;
            width: var(--width);
            height: var(--length);
            background: var(--gradient);
            border-radius: 50%;
            transform-origin: bottom center;
            animation: burst-out var(--duration) cubic-bezier(0.17, 0.89, 0.32, 1.28) forwards;
            box-shadow: 0 0 8px var(--color), 0 0 15px var(--color), 0 0 25px var(--color);
        }
        @keyframes burst-out {
            0% { transform: rotate(var(--angle)) scale(0); opacity: 1; }
            20% { transform: rotate(var(--angle)) scale(1.1) translateY(var(--offset)); opacity: 1; }
            100% { transform: rotate(var(--angle)) scale(1.2) translateY(calc(var(--offset) + 5px)); opacity: 0; }
        }

        .fire-center {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--center-color);
            box-shadow: 0 0 20px var(--center-color), 0 0 40px var(--center-color), 0 0 60px var(--center-color);
            animation: center-fade 0.8s ease-out forwards, flicker 0.1s ease-in-out infinite;
        }
        @keyframes center-fade {
            0% { opacity: 1; transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { opacity: 0; transform: scale(3); }
        }
        @keyframes flicker {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .fire-ember {
            position: absolute;
            width: 2px;
            height: 2px;
            border-radius: 50%;
            background: var(--color);
            opacity: 0.8;
            animation: ember-fall var(--ember-duration) ease-in forwards;
            box-shadow: 0 0 5px var(--color);
        }
        @keyframes ember-fall {
            0% { transform: rotate(var(--angle)) translate(0, 0); opacity: 0.8; }
            100% { transform: rotate(var(--angle)) translate(10px, 30px); opacity: 0; }
        }

        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            display: flex;
            gap: 15px;
        }
        .control-btn {
            padding: 8px 16px;
            background: rgba(255, 215, 0, 0.8);
            color: #000;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        .control-btn:hover {
            background: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }
        .control-btn:active {
            transform: translateY(0);
        }

        #soundBtn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 999;
            padding: 10px 20px;
            background: #ffd700;
            color: #000;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #soundBtn:hover {
            background: #ffea00;
            box-shadow: 0 0 10px #ffd700;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .photo-container {
                width: 150px;
                height: 150px;
            }
            .photo {
                width: 150px;
                height: 150px;
                border-width: 4px;
            }
            .countdown {
                font-size: 18px;
                top: 10px;
                left: 10px;
            }
            #soundBtn {
                top: 10px;
                right: 10px;
                padding: 8px 15px;
                font-size: 14px;
            }
            .controls {
                bottom: 10px;
                gap: 10px;
            }
            .control-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }

        /* é›ªèŠ±æ•ˆæœï¼ˆå¯é€‰ï¼‰ */
        .snowflake {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            opacity: 0.8;
            pointer-events: none;
            animation: snowfall linear infinite;
            z-index: 2;
        }
        @keyframes snowfall {
            0% { transform: translateY(-10px) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        /* å…¨å±æç¤º */
        .fullscreen-tip {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #fff;
            font-size: 14px;
            opacity: 0.7;
            z-index: 999;
        }
    </style>
</head>
<body>
    <!-- å€’è®¡æ—¶ -->
    <div class="countdown">
        <span>è·ç¦»2026è¿˜æœ‰ï¼š</span>
        <span class="countdown-number" id="countdownTimer">00:00:00</span>
    </div>

    <!-- å£°éŸ³æŒ‰é’® -->
    <button id="soundBtn">ç‚¹å‡»å¼€å¯å£°éŸ³</button>

    <!-- æ§åˆ¶æŒ‰é’® -->
    <div class="controls">
        <button class="control-btn" id="pauseBtn">æš‚åœçƒŸèŠ±</button>
        <button class="control-btn" id="speedUpBtn">åŠ å¿«çƒŸèŠ±</button>
        <button class="control-btn" id="addEffectBtn">åˆ‡æ¢ç‰¹æ•ˆ</button>
        <button class="control-btn" id="fullscreenBtn">å…¨å±æ˜¾ç¤º</button>
    </div>

    <!-- å…¨å±æç¤º -->
    <div class="fullscreen-tip">ğŸ‡ ç‚¹å‡»å…¨å±ä½“éªŒæ›´ä½³</div>

    <!-- èƒŒæ™¯æ˜Ÿç©º -->
    <div class="stars" id="stars"></div>

    <!-- é›ªèŠ±æ•ˆæœ -->
    <div id="snowContainer"></div>

    <!-- çƒŸèŠ±å®¹å™¨ -->
    <div class="firework-container" id="fireworkContainer"></div>

    <!-- ä¸»å†…å®¹ - æ›¿æ¢ä¸ºç¨³å®šçš„æµ‹è¯•å›¾ç‰‡é“¾æ¥ -->
    <div class="photo-wrap" id="photoWrap">
        <div class="title">ğŸ‰ 2026è·¨å¹´å¿«ä¹ ğŸ‰</div>
        <div class="photo-container">
            <img src="https://s41.ax1x.com/2025/12/24/pZGHqdf.jpg" class="photo photo1" alt="æˆ‘çš„ç…§ç‰‡1">
            <img src="https://s41.ax1x.com/2025/12/24/pZGHxzj.jpg"class="photo photo2" alt="æˆ‘çš„ç…§ç‰‡2">
            <img src="https://s41.ax1x.com/2025/12/24/pZGHjJg.jpg" class="photo photo3" alt="æˆ‘çš„ç…§ç‰‡3">
            <img src="https://s41.ax1x.com/2025/12/24/pZGHbeP.jpg" class="photo photo4" alt="æˆ‘çš„ç…§ç‰‡4">
            <img src="https://s41.ax1x.com/2025/12/24/pZGHXFS.jpg" class="photo photo5" alt="æˆ‘çš„ç…§ç‰‡5">
        </div>
        <div class="bless">
            å‘Šåˆ«2025ï¼Œå¥”èµ´2026<br>
            æ„¿æ–°å²ï¼šå¹³å®‰å–œä¹ï¼Œä¸‡äº‹èƒœæ„ âœ¨
        </div>
    </div>

    <script>
        // é…ç½®é¡¹ï¼ˆå¯çµæ´»è°ƒæ•´ï¼‰
        const CONFIG = {
            firePerPhoto: 10,
            photoSwitchDelay: 2000, // å»¶é•¿ç…§ç‰‡åˆ‡æ¢æ—¶é—´ï¼Œæå‡ä½“éªŒ
            totalPhotos: 5,
            totalCycles: Infinity, // æ— é™å¾ªç¯
            batchFireCount: { min:2, max:6 }, // å¢åŠ çƒŸèŠ±æ•°é‡
            batchInterval: 800, // åŠ å¿«çƒŸèŠ±å‘å°„é¢‘ç‡
            burstCount: 120, // å¢åŠ çƒŸèŠ±ç²’å­æ•°
            burstLengthRange: { min:60, max:180 },
            burstWidthRange: { min:1, max:4 },
            soundEnabled: true,
            soundVolume: 0.7,
            shapeTypes: ['circle', 'heart', 'star', 'flower'], // å¤šç§çƒŸèŠ±å½¢çŠ¶
            currentShapeType: 0,
            fireworkHeightRange: { min:20, max:80 },
            fireworkSpeed: 1, // çƒŸèŠ±é€Ÿåº¦æ§åˆ¶
            isPaused: false, // æš‚åœçŠ¶æ€
            snowEnabled: true, // é›ªèŠ±æ•ˆæœ
            starCount: 200, // æ˜Ÿç©ºæ•°é‡
            effectIntensity: 1 // ç‰¹æ•ˆå¼ºåº¦
        };

        // ========== å·¥å…·å‡½æ•° ==========
        function getRandom(min, max) {
            return Math.random() * (max - min) + min;
        }

        function getRandomColor() {
            const colorSets = [
                { main: '#ff0000', light: '#ff9999', center: '#ff3333' },
                { main: '#ff9900', light: '#ffcc99', center: '#ffaa00' },
                { main: '#ffff00', light: '#ffff99', center: '#ffff33' },
                { main: '#00ff00', light: '#99ff99', center: '#33ff33' },
                { main: '#00ffff', light: '#99ffff', center: '#33ffff' },
                { main: '#0000ff', light: '#9999ff', center: '#3333ff' },
                { main: '#9900ff', light: '#cc99ff', center: '#aa33ff' },
                { main: '#ff00ff', light: '#ff99ff', center: '#ff33ff' },
                { main: '#ffd700', light: '#ffffcc', center: '#ffea00' },
                { main: '#cccccc', light: '#ffffff', center: '#eeeeee' }
            ];
            return colorSets[Math.floor(getRandom(0, colorSets.length))];
        }

        // ========== è§†è§‰å¢å¼ºï¼šæ˜Ÿç©ºèƒŒæ™¯ ==========
        function createStars() {
            const starsContainer = document.getElementById('stars');
            starsContainer.innerHTML = '';
            
            for (let i = 0; i < CONFIG.starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // éšæœºå¤§å°å’Œä½ç½®
                const size = getRandom(1, 3);
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${getRandom(0, 100)}%`;
                star.style.top = `${getRandom(0, 100)}%`;
                
                // éšæœºé—ªçƒåŠ¨ç”»
                star.style.animationDuration = `${getRandom(2, 5)}s`;
                star.style.animationDelay = `${getRandom(0, 5)}s`;
                
                // éšæœºé€æ˜åº¦
                star.style.opacity = getRandom(0.3, 1);
                
                starsContainer.appendChild(star);
            }
        }

        // ========== è§†è§‰å¢å¼ºï¼šé›ªèŠ±æ•ˆæœ ==========
        function createSnowflakes() {
            if (!CONFIG.snowEnabled) return;
            
            const snowContainer = document.getElementById('snowContainer');
            const flakeCount = window.innerWidth / 10; // æ ¹æ®å±å¹•å®½åº¦è°ƒæ•´é›ªèŠ±æ•°é‡
            
            // æ¸…ç†æ—§é›ªèŠ±
            while (snowContainer.firstChild) {
                snowContainer.removeChild(snowContainer.firstChild);
            }
            
            for (let i = 0; i < flakeCount; i++) {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                
                // éšæœºå¤§å°
                const size = getRandom(2, 6);
                flake.style.width = `${size}px`;
                flake.style.height = `${size}px`;
                
                // éšæœºä½ç½®
                flake.style.left = `${getRandom(0, 100)}%`;
                flake.style.top = `${getRandom(-100, 0)}px`;
                
                // éšæœºä¸‹è½é€Ÿåº¦å’ŒåŠ¨ç”»
                const duration = getRandom(10, 30);
                flake.style.animationDuration = `${duration}s`;
                flake.style.animationDelay = `${getRandom(0, 10)}s`;
                
                // éšæœºåç§»
                flake.style.transform = `translateX(${getRandom(-50, 50)}px)`;
                
                snowContainer.appendChild(flake);
                
                // é›ªèŠ±è½åœ°åé‡æ–°ç”Ÿæˆ
                setTimeout(() => {
                    flake.remove();
                    setTimeout(() => createSnowflakes(), getRandom(0, 1000));
                }, duration * 1000);
            }
        }

        // ========== å€’è®¡æ—¶åŠŸèƒ½ ==========
        function updateCountdown() {
            // è®¾ç½®2026å¹´å…ƒæ—¦ä¸ºç›®æ ‡æ—¶é—´
            const targetDate = new Date('2026-01-01T00:00:00');
            const now = new Date();
            
            // è®¡ç®—æ—¶é—´å·®
            const diff = targetDate - now;
            
            if (diff <= 0) {
                document.getElementById('countdownTimer').textContent = 'æ–°å¹´å¿«ä¹ï¼';
                // æ–°å¹´ç‰¹æ•ˆï¼šå¢å¼ºçƒŸèŠ±æ•ˆæœ
                CONFIG.batchInterval = 500;
                CONFIG.batchFireCount = { min:4, max:8 };
                document.querySelector('.photo-wrap').classList.add('zoom-in');
                return;
            }
            
            // è½¬æ¢ä¸ºæ—¶åˆ†ç§’
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            // æ ¼å¼åŒ–æ˜¾ç¤º
            const formatted = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('countdownTimer').textContent = formatted;
        }

        // ========== éŸ³é¢‘ç³»ç»Ÿä¼˜åŒ– ==========
        let audioContext;
        function initAudio() {
            try {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                audioContext = new AudioContext();
                return true;
            } catch (e) {
                console.log("Web Audio ä¸å¯ç”¨:", e);
                CONFIG.soundEnabled = false;
                return false;
            }
        }
        // å»¶è¿Ÿåˆå§‹åŒ–éŸ³é¢‘ï¼Œé¿å…æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾é™åˆ¶
        document.getElementById('soundBtn').addEventListener('click', function() {
            if (!audioContext) initAudio();
        });

        // æ›´çœŸå®çš„çƒŸèŠ±çˆ†ç‚¸å£°
        function playExplodeSound(xPos) {
            if (!audioContext || !CONFIG.soundEnabled || CONFIG.isPaused) return;

            // åˆ›å»ºä¸»å¢ç›Šæ§åˆ¶
            const masterGain = audioContext.createGain();
            masterGain.gain.value = CONFIG.soundVolume;
            masterGain.connect(audioContext.destination);

            // 1. è¶…ä½é¢‘åŸºç¡€ï¼ˆæ¨¡æ‹Ÿç©ºæ°”éœ‡åŠ¨ï¼‰
            const subBass = audioContext.createOscillator();
            const subBassGain = audioContext.createGain();
            subBass.type = 'sine';
            const subFreq = 20 + Math.random() * 15;
            subBass.frequency.setValueAtTime(subFreq, audioContext.currentTime);
            subBassGain.gain.setValueAtTime(0, audioContext.currentTime);
            subBassGain.gain.linearRampToValueAtTime(1.0, audioContext.currentTime + 0.02);
            subBassGain.gain.linearRampToValueAtTime(0.7, audioContext.currentTime + 0.05);
            subBassGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1.2);
            subBass.connect(subBassGain);
            subBassGain.connect(masterGain);
            subBass.start();
            subBass.stop(audioContext.currentTime + 1.2);

            // 2. ä½é¢‘ä¸»ä½“ï¼ˆå˜­å£°æ ¸å¿ƒï¼‰
            const bass = audioContext.createOscillator();
            const bassGain = audioContext.createGain();
            bass.type = 'sine';
            const bassFreq = 60 + Math.random() * 40;
            bass.frequency.setValueAtTime(bassFreq, audioContext.currentTime);
            bass.frequency.exponentialRampToValueAtTime(20, audioContext.currentTime + 0.3);
            bassGain.gain.setValueAtTime(0, audioContext.currentTime);
            bassGain.gain.linearRampToValueAtTime(0.8, audioContext.currentTime + 0.03);
            bassGain.gain.linearRampToValueAtTime(0.4, audioContext.currentTime + 0.1);
            bassGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.8);
            bass.connect(bassGain);
            bassGain.connect(masterGain);
            bass.start();
            bass.stop(audioContext.currentTime + 0.8);

            // 3. è½»å¾®ä¸­é¢‘ç‚¹ç¼€
            const mid = audioContext.createOscillator();
            const midGain = audioContext.createGain();
            mid.type = 'triangle';
            const midFreq = 200 + Math.random() * 100;
            mid.frequency.setValueAtTime(midFreq, audioContext.currentTime);
            mid.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.2);
            midGain.gain.setValueAtTime(0, audioContext.currentTime);
            midGain.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.04);
            midGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
            mid.connect(midGain);
            midGain.connect(masterGain);
            mid.start();
            mid.stop(audioContext.currentTime + 0.3);

            // 4. ä½é¢‘å™ªéŸ³çº¹ç†
            const noise = audioContext.createBufferSource();
            const noiseGain = audioContext.createGain();
            const noiseFilter = audioContext.createBiquadFilter();
            const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.5, audioContext.sampleRate);
            const noiseData = noiseBuffer.getChannelData(0);
            for (let i = 0; i < noiseBuffer.length; i++) {
                noiseData[i] = Math.random() * 2 - 1; // ç™½å™ªéŸ³
            }
            noise.buffer = noiseBuffer;
            noiseFilter.type = 'lowpass';
            noiseFilter.frequency.setValueAtTime(500, audioContext.currentTime);
            noiseGain.gain.setValueAtTime(0, audioContext.currentTime);
            noiseGain.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 0.03);
            noiseGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.4);
            noise.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            noiseGain.connect(masterGain);
            noise.start();
            noise.stop(audioContext.currentTime + 0.4);

            // ç©ºé—´æ„Ÿï¼šå·¦å³å£°é“åç§»
            const panNode = audioContext.createStereoPanner();
            const panValue = (xPos / window.innerWidth - 0.5) * 1.5;
            panNode.pan.value = panValue;
            masterGain.connect(panNode);
            panNode.connect(audioContext.destination);

            // å›å£°æ•ˆæœ
            setTimeout(() => {
                const echo = audioContext.createOscillator();
                const echoGain = audioContext.createGain();
                echo.type = 'sine';
                echo.frequency.setValueAtTime(40 + Math.random() * 20, audioContext.currentTime);
                echoGain.gain.setValueAtTime(0.15 * CONFIG.soundVolume, audioContext.currentTime);
                echoGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1.0);
                echo.connect(echoGain);
                echoGain.connect(panNode);
                echo.start();
                echo.stop(audioContext.currentTime + 1.0);
            }, 80 + Math.random() * 50);
        }

        // ========== çƒŸèŠ±å½¢çŠ¶ç³»ç»Ÿ ==========
        function getShapeAngle(baseAngle, shapeType) {
            const angle = baseAngle % 360;
            
            switch (shapeType) {
                case 'heart':
                    const rad = angle * Math.PI / 180;
                    const r = 100 * (1 - Math.sin(rad));
                    return angle + (Math.random() * 10 - 5);
                    
                case 'star':
                    if (Math.floor(angle / 72) % 2 === 0) {
                        return angle + (Math.random() * 8 - 4);
                    } else {
                        return angle + (Math.random() * 12 - 6);
                    }
                    
                case 'flower':
                    const petalCount = 8;
                    const petalAngle = 360 / petalCount;
                    return Math.round(angle / petalAngle) * petalAngle + (Math.random() * 5 - 2.5);
                    
                case 'circle':
                default:
                    return angle + (Math.random() * 3 - 1.5);
            }
        }

        // ========== çƒŸèŠ±å¯¹è±¡æ± ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ ==========
        const state = {
            totalFireCount: 0,
            currentPhotoIndex: 1,
            cycleCount: 0,
            isPhotoShow: true,
            isCycleCompleted: false,
            fireworkPool: { 
                trail: [], 
                burst: [], 
                center: [], 
                ember: [] 
            },
            fireworkContainer: document.getElementById('fireworkContainer'),
            photoWrap: document.getElementById('photoWrap'),
            photoElements: [],
            animationIds: [] // å­˜å‚¨åŠ¨ç”»IDï¼Œç”¨äºæš‚åœ/æ¢å¤
        };

        // è·å–/å›æ”¶DOMå…ƒç´ ï¼ˆå‡å°‘DOMæ“ä½œï¼Œæå‡æ€§èƒ½ï¼‰
        function getElementFromPool(type) {
            if (state.fireworkPool[type].length > 0) {
                const el = state.fireworkPool[type].pop();
                el.style.display = 'block';
                return el;
            }
            const el = document.createElement('div');
            el.className = `fire-${type}`;
            state.fireworkContainer.appendChild(el);
            return el;
        }

        function recycleElementToPool(el, type) {
            el.style.display = 'none';
            state.fireworkPool[type].push(el);
            if (state.fireworkPool[type].length > 500) {
                state.fireworkPool[type].shift().remove();
            }
        }

        // ========== æ ¸å¿ƒçƒŸèŠ±é€»è¾‘ ==========
        function createFirework() {
            if (CONFIG.isPaused) return;
            
            const x = getRandom(50, window.innerWidth - 50);
            const heightPercent = getRandom(
                CONFIG.fireworkHeightRange.min, 
                CONFIG.fireworkHeightRange.max
            );
            const top = (window.innerHeight * heightPercent) / 100;

            // åˆ›å»ºçƒŸèŠ±è½¨è¿¹
            const trail = getElementFromPool('trail');
            trail.style.left = `${x}px`;
            trail.style.setProperty('--top', `${top}px`);
            trail.style.animation = `fly-up ${1.5 / CONFIG.fireworkSpeed}s ease-out forwards, sway 0.3s ease-in-out infinite`;

            // çƒŸèŠ±çˆ†ç‚¸
            setTimeout(() => {
                if (CONFIG.isPaused) return;
                
                // æ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆ
                playExplodeSound(x);

                const currentShape = CONFIG.shapeTypes[CONFIG.currentShapeType];
                const colorSet1 = getRandomColor();
                const colorSet2 = getRandomColor();
                const useDualColor = Math.random() > 0.4;

                // çƒŸèŠ±ä¸­å¿ƒ
                const center = getElementFromPool('center');
                center.style.left = `${x - 10}px`;
                center.style.bottom = `${top}px`;
                center.style.setProperty('--center-color', colorSet1.center);
                setTimeout(() => recycleElementToPool(center, 'center'), 800);

                // çƒŸèŠ±ç²’å­
                for (let i = 0; i < CONFIG.burstCount * CONFIG.effectIntensity; i++) {
                    const burst = getElementFromPool('burst');
                    burst.style.left = `${x}px`;
                    burst.style.bottom = `${top}px`;
                    
                    const baseAngle = (i * (360 / CONFIG.burstCount)) + getRandom(-2, 2);
                    burst.style.setProperty('--angle', `${getShapeAngle(baseAngle, currentShape)}deg`);
                    burst.style.setProperty('--length', `${getRandom(
                        CONFIG.burstLengthRange.min, 
                        CONFIG.burstLengthRange.max
                    )}px`);
                    burst.style.setProperty('--width', `${getRandom(
                        CONFIG.burstWidthRange.min, 
                        CONFIG.burstWidthRange.max
                    )}px`);
                    
                    let gradient, color;
                    if (useDualColor && Math.random() > 0.5) {
                        gradient = `linear-gradient(to top, transparent, ${colorSet1.light}, ${colorSet2.main})`;
                        color = colorSet2.main;
                    } else {
                        gradient = `linear-gradient(to top, transparent, ${colorSet1.light}, ${colorSet1.main})`;
                        color = colorSet1.main;
                    }
                    
                    burst.style.setProperty('--color', color);
                    burst.style.setProperty('--gradient', gradient);
                    burst.style.setProperty('--duration', `${getRandom(0.8, 1.8) / CONFIG.fireworkSpeed}s`);
                    burst.style.setProperty('--offset', `${getRandom(-5, 5)}px`);
                    
                    setTimeout(() => recycleElementToPool(burst, 'burst'), 
                        getRandom(0.8, 1.8)*1000 / CONFIG.fireworkSpeed + 200);

                    // ç«æ˜Ÿæ•ˆæœ
                    if (i % 8 === 0) {
                        const ember = getElementFromPool('ember');
                        ember.style.left = `${x}px`;
                        ember.style.bottom = `${top}px`;
                        ember.style.setProperty('--angle', `${getShapeAngle(baseAngle, currentShape)}deg`);
                        ember.style.setProperty('--color', useDualColor ? colorSet2.light : colorSet1.light);
                        ember.style.setProperty('--ember-duration', `${getRandom(1.5, 2.5) / CONFIG.fireworkSpeed}s`);
                        setTimeout(() => recycleElementToPool(ember, 'ember'), 
                            getRandom(1.5, 2.5)*1000 / CONFIG.fireworkSpeed);
                    }
                }
                
                setTimeout(() => recycleElementToPool(trail, 'trail'), 500 / CONFIG.fireworkSpeed);
            }, 1500 / CONFIG.fireworkSpeed);

            // ç…§ç‰‡åˆ‡æ¢é€»è¾‘
            if (!state.isCycleCompleted) {
                state.totalFireCount++;
                if (state.totalFireCount % CONFIG.firePerPhoto === 0) {
                    setTimeout(() => {
                        if (CONFIG.isPaused) return;
                        
                        // ç§»é™¤æ‰€æœ‰activeç±»
                        state.photoElements.forEach(el => {
                            el.classList.remove('active', 'prev', 'next');
                        });
                        
                        // æ›´æ–°ç…§ç‰‡ç´¢å¼•
                        const prevIndex = state.currentPhotoIndex;
                        state.currentPhotoIndex = state.currentPhotoIndex >= CONFIG.totalPhotos ? 1 : state.currentPhotoIndex + 1;
                        
                        // æ·»åŠ 3Dåˆ‡æ¢ç±»
                        state.photoElements[prevIndex - 1].classList.add('prev');
                        state.photoElements[state.currentPhotoIndex - 1].classList.add('active');
                        
                    }, CONFIG.photoSwitchDelay);
                }
            }
        }

        // æ‰¹é‡åˆ›å»ºçƒŸèŠ± - ä¿®å¤æ‰§è¡Œé€»è¾‘
        function createBatchFireworks() {
            if (CONFIG.isPaused) {
                state.animationIds.push(setTimeout(createBatchFireworks, CONFIG.batchInterval));
                return;
            }
            
            const batchCount = Math.floor(getRandom(
                CONFIG.batchFireCount.min, 
                CONFIG.batchFireCount.max + 1
            ));
            
            for (let i = 0; i < batchCount; i++) {
                state.animationIds.push(setTimeout(() => createFirework(), i * 50 / CONFIG.fireworkSpeed));
            }
            
            state.animationIds.push(setTimeout(createBatchFireworks, CONFIG.batchInterval / CONFIG.fireworkSpeed));
        }

        // ========== æ§åˆ¶åŠŸèƒ½ ==========
        function initControls() {
            // æš‚åœ/ç»§ç»­æŒ‰é’®
            const pauseBtn = document.getElementById('pauseBtn');
            pauseBtn.addEventListener('click', () => {
                CONFIG.isPaused = !CONFIG.isPaused;
                pauseBtn.textContent = CONFIG.isPaused ? 'ç»§ç»­çƒŸèŠ±' : 'æš‚åœçƒŸèŠ±';
                
                if (CONFIG.isPaused) {
                    state.animationIds.forEach(id => clearTimeout(id));
                    state.animationIds = [];
                } else {
                    // æ¢å¤çƒŸèŠ±æ•ˆæœ
                    createBatchFireworks();
                }
            });

            // åŠ å¿«/å‡é€ŸæŒ‰é’®
            const speedUpBtn = document.getElementById('speedUpBtn');
            speedUpBtn.addEventListener('click', () => {
                CONFIG.fireworkSpeed = CONFIG.fireworkSpeed === 2 ? 1 : 2;
                speedUpBtn.textContent = CONFIG.fireworkSpeed === 2 ? 'å‡æ…¢çƒŸèŠ±' : 'åŠ å¿«çƒŸèŠ±';
            });

            // åˆ‡æ¢ç‰¹æ•ˆæŒ‰é’®
            const addEffectBtn = document.getElementById('addEffectBtn');
            addEffectBtn.addEventListener('click', () => {
                CONFIG.currentShapeType = (CONFIG.currentShapeType + 1) % CONFIG.shapeTypes.length;
                CONFIG.effectIntensity = CONFIG.effectIntensity === 1.5 ? 1 : 1.5;
                addEffectBtn.textContent = `ç‰¹æ•ˆ: ${CONFIG.shapeTypes[CONFIG.currentShapeType]}`;
                
                CONFIG.snowEnabled = !CONFIG.snowEnabled;
                createSnowflakes();
            });

            // å…¨å±æŒ‰é’®
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            fullscreenBtn.addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`å…¨å±è¯·æ±‚å¤±è´¥: ${err.message}`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            });

            // å£°éŸ³æŒ‰é’®
            const soundBtn = document.getElementById('soundBtn');
            soundBtn.addEventListener('click', function() {
                if (audioContext) {
                    audioContext.resume().then(() => {
                        soundBtn.textContent = 'å£°éŸ³å·²å¼€å¯ âœ¨';
                        soundBtn.disabled = true;
                        soundBtn.style.opacity = '0.7';
                    }).catch(err => {
                        soundBtn.textContent = 'å¼€å¯æˆåŠŸ';
                    });
                }
            });
        }

        // ========== åˆå§‹åŒ– - ä¿®å¤æ‰§è¡Œé¡ºåº ==========
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ç…§ç‰‡å…ƒç´ 
            state.photoElements = [
                document.querySelector('.photo1'),
                document.querySelector('.photo2'),
                document.querySelector('.photo3'),
                document.querySelector('.photo4'),
                document.querySelector('.photo5')
            ];
            
            // å¼ºåˆ¶æ¿€æ´»ç¬¬ä¸€å¼ ç…§ç‰‡
            state.photoElements[0].classList.add('active');

            // åˆ›å»ºæ˜Ÿç©º
            createStars();
            
            // åˆ›å»ºé›ªèŠ±
            createSnowflakes();
            
            // åˆå§‹åŒ–å€’è®¡æ—¶
            updateCountdown();
            setInterval(updateCountdown, 1000);
            
            // åˆå§‹åŒ–æ§åˆ¶æŒ‰é’®
            initControls();
            
            // ç«‹å³å¯åŠ¨çƒŸèŠ±æ•ˆæœï¼ˆä¿®å¤æ ¸å¿ƒé—®é¢˜ï¼‰
            setTimeout(() => {
                createBatchFireworks();
                // ç«‹å³åˆ›å»ºç¬¬ä¸€ä¸ªçƒŸèŠ±
                createFirework();
            }, 500);
            
            // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°åˆ›å»ºæ˜Ÿç©ºå’Œé›ªèŠ±
            window.addEventListener('resize', function() {
                createStars();
                createSnowflakes();
                
                Object.keys(state.fireworkPool).forEach(type => {
                    state.fireworkPool[type].forEach(el => el.remove());
                    state.fireworkPool[type] = [];
                });
            });
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', () => {
            state.animationIds.forEach(id => clearTimeout(id));
            if (audioContext) {
                audioContext.close();
            }
        });
    </script>
</body>
</html>